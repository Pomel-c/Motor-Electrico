{% extends 'base.html' %}

{% block title %}Sistema de Monitoreo - Detalles de Motor{% endblock %}

{% block content %}

<h1 class="mb-4">Detalles de Motor</h1>

<div class="row">
    <!-- Cuadro de "Motor Characteristics" -->
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h4>Caracteristicas de Motor</h4>
            </div>
            <div class="card-body">
                <ul class="list-group">
                    <ul class="list-group-item">Voltage: {{ voltage }} </ul>
                    <ul class="list-group-item">RPM: {{ rpm }}</ul>
                    <ul class="list-group-item">Current: {{ current }} </ul>
                    <ul class="list-group-item">Frequency: {{ frequency }} </ul>
                    <ul class="list-group-item">Max Temperature: {{ max_temp }}°C</ul>
                    <ul class="list-group-item">Rated Power: {{ rated_power }} HP</ul>
                </ul>
            </div>
        </div>
    </div>

    <!-- Cuadro de "Consejos de Mantenimiento y Recursos Externos" -->
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h4>Tips de Mantenimiento</h4>
            </div>
            <div class="card-body">
                <ul>Clean the motor regularly to remove dust and debris.</ul>
                <ul>Lubricate moving parts according to manufacturer's recommendations.</ul>
                <ul>Inspect cables and connections for wear and tear.</ul>
                <ul>Perform regular tests of operation and load.</ul>
                <ul>Avoid frequent starts and stops to extend the lifespan.</ul>
                <ul>Maintain a maintenance record and schedule.</ul>
            </div>
        </div>
    </div>
</div>

<!-- Indicadores de estado -->
<div class="card">
    <div class="card-header">
        <h4>Indicadores de Estado del Motor</h4>
    </div>
    <div class="card-body">
        <div class="indicator">
            <div class="indicator-circle status-green"></div>
            <h5>Voltaje:</h5>
            <div class="indicator-value">
                <span id="voltaje"></span>
                <span class="indicator-value">W</span>  
            </div>
            <div class="indicator-value">Expected: 220-240 V</div>
            <div class="indicator-status status-green">Normal</div>
        </div>
        <div class="indicator">
            <div class="indicator-circle status-yellow"></div>
            <h5>Corriente:</h5>
            <div class="indicator-value">
                <span id="corriente"></span>
                <span class="indicator-value">A</span>  
            </div>
            <div class="indicator-value">Expected: 2.0-3.0 A</div>
            <div class="indicator-status status-yellow" id="corriente-indicator">Attention</div>
        </div>
        <div class="indicator">
            <div class="indicator-circle status-red"></div>
            <h5>Temperatura:</h5>
            <div class="indicator-value">
                <span id="temperatura"></span>
                <span class="indicator-value">°C</span>  
            </div>
            <div class="indicator-value">Expected: < 80°C</div>
            <div class="indicator-status status-red">Danger</div>
        </div>
        <div class="indicator">
            <div class="indicator-circle status-green"></div>
            <h5>RPM:</h5>
            <div class="indicator-value">
                <span id="rpm"></span>
                <span class="indicator-value">rpm</span>  
            </div>
            <div class="indicator-value">Expected: 1500 RPM</div>
            <div class="indicator-status status-green" id="rpm-indicator">Normal</div>
        </div>
    </div>
</div>

<!-- Script to change indicator status -->
<script>
    window.onload = function () {
        let socket = io();
        socket.on('data', function(data) {
            document.getElementById('temperatura').textContent = data.temperatura;
            document.getElementById('voltaje').textContent = data.voltaje;
            document.getElementById('corriente').textContent = data.corriente;
            document.getElementById('rpm').textContent = data.rpm;

            // Change indicator status based on data
            let voltageIndicator = document.querySelector('#voltaje').parentNode.parentNode.querySelector('.indicator-status');
            if (data.voltaje < 200 || data.voltaje > 260) {
                voltageIndicator.classList.remove('status-green');
                voltageIndicator.classList.add('status-red');
                voltageIndicator.textContent = 'Danger';
            } else if (data.voltaje < 210 || data.voltaje > 250) {
                voltageIndicator.classList.remove('status-green');
                voltageIndicator.classList.add('status-yellow');
                voltageIndicator.textContent = 'Attention';
            } else {
                voltageIndicator.classList.remove('status-yellow', 'status-red');
                voltageIndicator.classList.add('status-green');
                voltageIndicator.textContent = 'Normal';
            }

            let corrienteIndicator = document.querySelector('#corriente').parentNode.parentNode.querySelector('.indicator-status');
            if (data.corriente < 1.5 || data.corriente > 3.5) {
                corrienteIndicator.classList.remove('status-green');
                corrienteIndicator.classList.add('status-red');
                corrienteIndicator.textContent = 'Danger';
            } else if (data.corriente < 2.0 || data.corriente > 3.0) {
                corrienteIndicator.classList.remove('status-green');
                corrienteIndicator.classList.add('status-yellow');
                corrienteIndicator.textContent = 'Attention';
            } else {
                corrienteIndicator.classList.remove('status-yellow', 'status-red');
                corrienteIndicator.classList.add('status-green');
                corrienteIndicator.textContent = 'Normal';
            }

            let temperaturaIndicator = document.querySelector('#temperatura').parentNode.parentNode.querySelector('.indicator-status');
            if (data.temperatura > 90) {
                temperaturaIndicator.classList.remove('status-green', 'status-yellow');
                temperaturaIndicator.classList.add('status-red');
                temperaturaIndicator.textContent = 'Danger';
            } else if (data.temperatura > 80) {
                temperaturaIndicator.classList.remove('status-green');
                temperaturaIndicator.classList.add('status-yellow');
                temperaturaIndicator.textContent = 'Attention';
            } else {
                temperaturaIndicator.classList.remove('status-yellow', 'status-red');
                temperaturaIndicator.classList.add('status-green');
                temperaturaIndicator.textContent = 'Normal';
            }

            let rpmIndicator = document.querySelector('#rpm').parentNode.parentNode.querySelector('.indicator-status');
            if (data.rpm < 1500 || data.rpm > 2000) {
                rpmIndicator.classList.remove('status-green');
                rpmIndicator.classList.add('status-red');
                rpmIndicator.textContent = 'Danger';
            } else if (data.rpm < 1600 || data.rpm > 1900) {
                rpmIndicator.classList.remove('status-green');
                rpmIndicator.classList.add('status-yellow');
                rpmIndicator.textContent = 'Attention';
            } else {
                rpmIndicator.classList.remove('status-yellow', 'status-red');
                rpmIndicator.classList.add('status-green');
                rpmIndicator.textContent = 'Normal';
            }
        });
    };
</script>

{% endblock %}